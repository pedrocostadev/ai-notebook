## 2026-01-10 - Persist Chat Selection

- Implemented localStorage persistence for selectedPdfId and selectedChapterId
- Added validation on load to clear invalid selections (deleted PDFs/chapters)
- Files changed: `src/renderer/src/hooks/usePdfs.ts`
- **Learnings:**
  - Followed existing pattern for expandedPdfIds localStorage persistence
  - Validation effect runs after loading=false to avoid premature clearing
  - TypeScript passes, tests blocked by environment issue (Linux/Mac Electron binary mismatch)

---

## 2026-01-10 - Loading State After PDF Selection

- Added `isUploading` state to usePdfs hook
- Show loading spinner in ChatContainer when uploading (replaces empty state)
- Files changed: `src/renderer/src/hooks/usePdfs.ts`, `src/renderer/src/App.tsx`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - Wrapped uploadPdf in try/finally to ensure isUploading resets on error
  - Reused Loader2 icon with animate-spin for consistency

---

## 2026-01-10 - Open PDF/Chapter from App

- Added IPC handlers: `pdf:open` and `pdf:open-chapter`
- Both use `shell.openPath()` to open PDF in system default viewer
- Added "Open" button in chat header (PDF & chapter views)
- Button only shows when status is 'done'
- Files changed: `src/main/ipc/pdf.handlers.ts`, `src/preload/index.ts`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - `shell.openPath()` returns error string if fails, empty string on success
  - PDF viewers don't support opening at specific page via CLI, so chapter just opens PDF

---

## 2026-01-10 - Unified Processing Indicator

- Sidebar now only shows chapters with status 'done' (hides processing chapters)
- Main chat header shows "Processing chapter X of Y" during PDF processing
- Added green "Ready to chat" indicator with CheckCircle when done
- Files changed: `src/renderer/src/components/pdf/PdfList.tsx`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - Simple filter `chapters.filter(c => c.status === 'done')` hides processing chapters
  - Calculate progress: doneChapters + 1 gives current processing chapter (1-indexed)

---
