## 2026-01-10 - Persist Chat Selection

- Implemented localStorage persistence for selectedPdfId and selectedChapterId
- Added validation on load to clear invalid selections (deleted PDFs/chapters)
- Files changed: `src/renderer/src/hooks/usePdfs.ts`
- **Learnings:**
  - Followed existing pattern for expandedPdfIds localStorage persistence
  - Validation effect runs after loading=false to avoid premature clearing
  - TypeScript passes, tests blocked by environment issue (Linux/Mac Electron binary mismatch)

---

## 2026-01-10 - Loading State After PDF Selection

- Added `isUploading` state to usePdfs hook
- Show loading spinner in ChatContainer when uploading (replaces empty state)
- Files changed: `src/renderer/src/hooks/usePdfs.ts`, `src/renderer/src/App.tsx`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - Wrapped uploadPdf in try/finally to ensure isUploading resets on error
  - Reused Loader2 icon with animate-spin for consistency

---

## 2026-01-10 - Open PDF/Chapter from App

- Added IPC handlers: `pdf:open` and `pdf:open-chapter`
- Both use `shell.openPath()` to open PDF in system default viewer
- Added "Open" button in chat header (PDF & chapter views)
- Button only shows when status is 'done'
- Files changed: `src/main/ipc/pdf.handlers.ts`, `src/preload/index.ts`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - `shell.openPath()` returns error string if fails, empty string on success
  - PDF viewers don't support opening at specific page via CLI, so chapter just opens PDF

---

## 2026-01-10 - Unified Processing Indicator

- Sidebar now only shows chapters with status 'done' (hides processing chapters)
- Main chat header shows "Processing chapter X of Y" during PDF processing
- Added green "Ready to chat" indicator with CheckCircle when done
- Files changed: `src/renderer/src/components/pdf/PdfList.tsx`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - Simple filter `chapters.filter(c => c.status === 'done')` hides processing chapters
  - Calculate progress: doneChapters + 1 gives current processing chapter (1-indexed)

---

## 2026-01-10 - Improved Empty Chat Illustration

- Redesigned empty states with larger icons in circular containers
- Added subtle blur effect background for visual depth
- Consistent styling across: empty chat, no PDF selected, uploading states
- Improved slash command hints with inline code styling
- Files changed: `src/renderer/src/components/chat/MessageList.tsx`, `src/renderer/src/components/chat/ChatContainer.tsx`
- **Learnings:**
  - `scale-150 blur-xl` creates nice subtle glow effect behind elements
  - Consistent `max-w-sm` container keeps layout balanced on all screen sizes

---

## 2026-01-10 - Improved Welcome Screen

- Split layout: left side features, right side form (responsive)
- Added feature highlights: Smart Search, Natural Conversation, Auto Summaries
- Consistent visual style with other empty states (blur effects, icons)
- Form side shows icon on mobile only (`lg:hidden`)
- Changed button text from "Done" to "Get Started"
- Files changed: `src/renderer/src/components/settings/WelcomeScreen.tsx`
- **Learnings:**
  - `hidden lg:flex` pattern for responsive split layouts
  - Feature list with icons provides engaging "marketing" content

---

## 2026-01-10 - Chapter Open Button Opens at Chapter Page

- Fixed: chapter "Open" button now opens PDF at chapter's starting page
- Gets minimum page_start from chapter chunks to find chapter start
- Uses AppleScript on macOS to open Preview and navigate to page via Go To Page
- Files changed: `src/main/ipc/pdf.handlers.ts`, `src/preload/index.ts`
- **Learnings:**
  - macOS Preview doesn't support page param via CLI, but AppleScript works
  - Cmd+Opt+G opens "Go to Page" dialog in Preview
  - spawn with detached:true and unref() runs script async without blocking

---

## 2026-01-10 - Full Chapter List with Disabled State

- Sidebar now shows ALL chapters (not just done)
- Unprocessed chapters displayed with disabled styling (opacity-50, cursor-not-allowed)
- Removed checkmark indicator from chapter items (done chapters show no indicator)
- Processing chapters still show progress indicator
- Files changed: `src/renderer/src/components/pdf/PdfList.tsx`
- **Learnings:**
  - Simple opacity-50 + cursor-not-allowed for disabled state
  - conditional onClick: `onClick={() => isReady && onSelect(...)}`

---
